var loaded=!1;window.LocalData={isNew:!0,versoin:"1.0.0",_saveTime:0,uid:"",token:"",wxUserInfo:{id:null,openid:"",unionid:"",avatar:"",city:"",gender:0,language:"",nickname:"",province:"",inited:!1},whoInviteMe:null,_coin:2e4,get coin(){return null==this._coin&&(this._coin=0),this._coin},set coin(t){cc.log("use addCoin and subCoin")},addCoin:function(t){this._coin+=t,NC.postNotice(NC.KEY.COIN_CHANGED,this._coin),this.cumulativeCoin+=t},subCoin:function(t){return!(this._coin<t||(this._coin-=t,NC.postNotice(NC.KEY.COIN_CHANGED,this._coin),0))},_cumulativeCoin:0,get cumulativeCoin(){return this._cumulativeCoin},set cumulativeCoin(t){this._cumulativeCoin=t,NC.postNotice(NC.KEY.CUMULATIVE_COIN_CHANGED,this._cumulativeCoin)},_diamond:0,get diamond(){return this._diamond},set diamond(t){this._diamond=t,NC.postNotice(NC.KEY.DIAMOND_CHANGED,this._diamond)},_lotteryTime:3,get lotteryTime(){return this._lotteryTime},set lotteryTime(t){this._lotteryTime=t,NC.postNotice(NC.KEY.LOTTERY_TIME_CHANGED,this._lotteryTime)},shareTimeForFreeMatser:10,shareTimeForCoinLack:10,adTimeForFreeMaster:10,adTimeForCoinLack:10,_unlockMasterMaxLv:1,get unlockMasterMaxLv(){return this._unlockMasterMaxLv},set unlockMasterMaxLv(t){t>this._unlockMasterMaxLv&&(this._unlockMasterMaxLv=t,NC.postNotice(NC.KEY.UNLOCK_MASTER_MAX_LV_CHANGED,this._unlockMasterMaxLv),cc.sys.platform==cc.sys.WECHAT_GAME&&(boatSDK.ald.sendEvent("\u76ee\u524d\u89e3\u9501\u6700\u9ad8\u602a\u7269\u7b49\u7ea7",{lv:this._unlockMasterMaxLv.toString()}),this._unlockMasterMaxLv>=3&&null!=this.whoInviteMe&&(Utils.sendWhoInvite(this.whoInviteMe,!0),Utils.showToast("\u6211\u662f\u65b0\u7528\u6237\u5df2\u7ecf\u8fbe\u5230\u4e86\u7ed9\u5956\u52b1\u7684\u7b49\u7ea7\uff0c\u6211\u628a\u5956\u52b1\u53d1\u7ed9\u4e86:"+this.whoInviteMe),this.whoInviteMe=null)))},_castleLv:1,get castleLv(){return this._castleLv},set castleLv(t){this._castleLv!=t&&(this._castleLv=t,NC.postNotice(NC.KEY.CASTLE_LV_CHANGED,this._castleLv),cc.sys.platform==cc.sys.WECHAT_GAME&&boatSDK.ald.sendEvent("\u76ee\u524d\u89e3\u9501\u6700\u9ad8\u57ce\u5821\u7b49\u7ea7",{lv:this._castleLv.toString()}))},_castleRmainCoin:500,get castleRmainCoin(){return this._castleRmainCoin},set castleRmainCoin(t){this._castleRmainCoin=t,NC.postNotice(NC.KEY.CASTLE_REMAIN_COIN_CHANGED,this._castleRmainCoin)},subCastleRmainCoin:function(t){if(this.castleLv==Config.castleMaxLv)return;let e=this._castleLv;for(;t>0;)if(this.castleRmainCoin>t)this.castleRmainCoin-=t,t=0;else if(t-=this.castleRmainCoin,++e<=Config.castleMaxLv){let t=CSV.castle[e];this.castleRmainCoin=parseFloat(t.coin),this.diamond+=parseInt(CSV.castle[e-1].diamond)}else t=0,e=Config.castleMaxLv;this.castleLv=e},_checkBoardData:[],get checkBoardData(){return this._checkBoardData},set checkBoardData(t){this._checkBoardData=t,NC.postNotice(NC.KEY.CHECK_BORAD_DATA_CHANGED,this._checkBoardData)},_offTechnologyLv:0,get offTechnologyLv(){return this._offTechnologyLv>10&&(this._offTechnologyLv=10),this._offTechnologyLv},set offTechnologyLv(t){this._offTechnologyLv!=t&&(this._offTechnologyLv=t,NC.postNotice(NC.KEY.OFF_TECHNOLOGY_CHANGED,this._offTechnologyLv))},solveOffTechology:function(){if(this.offTechnologyLv<=0)return 0;{let t=CSV.technology[this.offTechnologyLv+10];return parseFloat(t.reward)/100}},_coinTechnologylv:0,get coinTechnologylv(){return this._coinTechnologylv>11&&(this._coinTechnologylv=10),this._coinTechnologylv},set coinTechnologylv(t){this._coinTechnologylv!=t&&(this._coinTechnologylv=t,NC.postNotice(NC.KEY.COIN_TECHNOLOGY_CHAGED,this._coinTechnologylv))},_coinIncreaseRates:[],addNewCoinIncreaseRate:function(t,e){this._coinIncreaseRates.push({start:Utils.getCurTime(),duration:t,rate:e})},updateCoinIncreaseRate:function(){let t=Utils.getCurTime();this._coinIncreaseRates=this._coinIncreaseRates.filter(function(e){return e.start+e.duration>t})},solveCoinIncreaseRate:function(){this.updateCoinIncreaseRate();let t=this._coinIncreaseRates.reduce(function(t,e){return t+e.rate},0),e=0;return CSV.technology[this.coinTechnologylv].reward&&(e=parseInt(CSV.technology[this.coinTechnologylv].reward)/100),t+e},solveRewordPerSecond:function(){return this._checkBoardData.reduce(function(t,e){let i=e.lv,s=CSV.master[i],n=parseFloat(s.speed);return t+parseFloat(s.reward)/(100/n)},0)*(1+this.solveCoinIncreaseRate())*(this.solveSpeedUpRate()+1)},solveCoinReward:function(t){return t*(1+this.solveCoinIncreaseRate())},_speedUpRates:[],updateSpeedUpRate:function(){let t=Utils.getCurTime();this._speedUpRates=this._speedUpRates.filter(function(e){return e.start+e.duration>t})},solveSpeedUpRate:function(){return this.updateSpeedUpRate(),this._speedUpRates.reduce(function(t,e){return t+e.rate},0)},getSpeedUpRemainTimeByVideo:function(){let t=this._speedUpRates.find(function(t){return"video"==t.type});return null==t?0:Math.max(0,t.start+t.duration-Utils.getCurTime())},addNewSpeedUpRate:function(t,e,i){this._speedUpRates.push({start:Utils.getCurTime(),duration:t,type:i,rate:e})},proceedOldSpeedUpRate:function(t,e,i){this.updateSpeedUpRate();let s=this._speedUpRates.find(function(t){return t.type==i});s?s.duration+=t:this.addNewSpeedUpRate(t,e,i)},_storageEggs:[],popStorageEgg:function(){return this._storageEggs.shift()},putStorageEgg:function(t){this._storageEggs.push(t)},freeVideoMasterTime:0,_masterBuyTimes:{},getMasterBuyTime:function(t){return this._masterBuyTimes[t]||0},addMasterBuyTimes:function(t,e){this._masterBuyTimes[t]=this._masterBuyTimes[t]||0,this._masterBuyTimes[t]+=e,NC.postNotice(NC.KEY.MASTER_BUY_TIMES_CHANGED)},solveMasterConstCoin:function(t){t=parseInt(t);let e=this._masterBuyTimes[t]||0,i=parseFloat(CSV.system[1].num);return Math.pow(i,e)*parseFloat(CSV.master[t].cost_coin)*(1-this.solveOffTechology())},shopMasterLayerY:null,shopTechLayerY:null,signinCanGetDay:1,signinGetTime:0,refreshSigninData:function(t,e){this.signinCanGetDay=t,this.signinGetTime=e,NC.postNotice(NC.KEY.SIGNIN_DATA_CHANGED)},invitedInfo:{},updateInvitedInfo:function(t){for(let e in t)if(t.hasOwnProperty(e)){let i=t[e];null==this.invitedInfo[e]?this.invitedInfo[e]={oldData:{count:0,isFirst:i.isFirst},newData:{count:i.count},info:{avatar:i.avatar},getRewardTime:0}:(this.invitedInfo[e].newData.count=i.count,0==Utils.offsetDay(this.invitedInfo[e].getRewardTime,Utils.getCurTime())&&(this.invitedInfo[e].oldData.count=this.invitedInfo[e].newData.count))}},getInvitedRewardAndReset:function(t){let e=this.invitedInfo[t];e.oldData.count=e.newData.count,e.oldData.lastGetRewardType=1==e.oldData.isFirst?"newPlayer":"oldPlayer",e.oldData.isFirst=!1,e.getRewardTime=Utils.getCurTime()},getAllInvitedRewardAndReset:function(){let t=0;for(let e in this.invitedInfo)if(this.invitedInfo[e]){let i=this.invitedInfo[e];Utils.offsetDay(i.getRewardTime,Utils.getCurTime())>0&&i.oldData.count<i.newData.count&&(i.oldData.isFirst?t+=30:t+=15,i.oldData.count=i.newData.count,i.oldData.lastGetRewardType=1==i.oldData.isFirst?"newPlayer":"oldPlayer",i.oldData.isFirst=!1,i.getRewardTime=Utils.getCurTime())}return t},isCanGetInvitedReward:function(){for(let t in this.invitedInfo)if(this.invitedInfo.hasOwnProperty(t)){let e=this.invitedInfo[t];if(e.newData.count>e.oldData.count&&Utils.offsetDay(e.getRewardTime,Utils.getCurTime())>0)return!0}return!1},registerEvent:function(){cc.game.on(cc.game.EVENT_HIDE,()=>{cc.log("LocalData game_hide"),this.save()}),cc.game.on(cc.game.EVENT_SHOW,()=>{cc.log("LocalData game_show"),NC.postNotice(NC.KEY.ON_GAME_SHOW)})},load:function(){if(1==loaded)return!0;loaded=!0,this.registerEvent();let t=cc.sys.localStorage.getItem("GuaiWu")||"",e=JSON.stringify(this);window._LocalDataDefault=JSON.parse(e);let i=t;if(null!=i&&""!=i){i=Utils.aesDecrypt(i);var s=JSON.parse(i);delete s.wxUserInfo,this.mixObj(this,s),this.versoin!==Config.version&&("1.0.0"==this.versoin&&(this.versoin="1.0.1"),"1.0.1"==this.versoin&&(this.versoin="1.0.2"),"1.0.2"==this.versoin&&(this.versoin="1.0.3"),"1.0.3"==this.versoin&&(this.versoin="1.0.4"),"1.0.4"==this.versoin&&(this.versoin="1.0.5"),"1.0.6"==this.versoin&&(this.versoin="1.0.7"),"1.0.7"==this.versoin&&(this.versoin="1.0.8"),"1.0.8"==this.versoin&&(this.versoin="1.0.9"),"1.0.9"==this.versoin&&(this.versoin="1.2"),this.versoin=Config.version,cc.sys.platform==cc.sys.WECHAT_GAME&&window.wxDownloader.cleanOldAssets()),this._refreshLimit()}},mixObj:function(t,e){_.each(e,function(i,s){e.hasOwnProperty(s)&&"function"!=typeof i&&"wxUserInfo"!=s&&(t[s]=i)})},save:function(){var t={};this.versoin=Config.version,this._refreshLimit(),this._saveTime=Utils.getCurTime(),Utils.mixObj(t,this),delete t.wxUserInfo;var e=JSON.stringify(t);if(e=Utils.aesEncrypt(e),cc.sys.localStorage.setItem("GuaiWu",e),cc.sys.platform==cc.sys.WECHAT_GAME){let t={};t.KVDataList=[{key:"cumulativeCoin",value:this._cumulativeCoin.toFixed(0)}],wx.setUserCloudStorage(t)}return e},_refreshLimit:function(){let t=moment(1e3*this._saveTime).format("YYYY-MM-DD");moment().format("YYYY-MM-DD")!=t&&(this.lotteryTime=3,this.shareTimeForFreeMatser=10,this.shareTimeForCoinLack=10,this.adTimeForFreeMaster=10,this.adTimeForCoinLack=10)},clear:function(){Utils.mixObj(this,_LocalDataDefault),this.save()},solveOffLineReward:function(){let t=Utils.getCurTime(),e=this._saveTime;if(t-e<60)return 0;let i=CSV.system[8].num.split("/"),s=parseFloat(i[0])/100,n=3600*parseFloat(i[1]),o=0;o=e+n<t?e+n:t;let a=[];a.push(e),a.push(o);for(let h=0;h<this._coinIncreaseRates.length;h++){let t=this._coinIncreaseRates[h],i=t.start+t.duration;i>e&&(i<=o?a.push(i):a.push(o))}for(let h=0;h<this._speedUpRates.length;h++){let t=this._speedUpRates[h],i=t.start+t.duration;i>e&&(i<=o?a.push(i):a.push(o))}(a=Utils.unique(a)).sort(function(t,e){return t-e}),cc.log("timeArray",a);let r=this._checkBoardData.reduce(function(t,e){let i=e.lv,s=CSV.master[i],n=parseFloat(s.speed);return t+parseFloat(s.reward)/(100/n)},0),c=0;for(let h=0;h<a.length-1;h++){let t=a[h],e=a[h+1];c+=r*(this._solveCoinIncreaseRateByTime(t,e)+1)*(this._solveSpeedUpRateByTime(t,e)+1)*(e-t)}let l=c*s;return cc.log("offline ",l),l},_solveCoinIncreaseRateByTime(t,e){let i=this._coinIncreaseRates.reduce(function(i,s){return s.start<=t&&s.start+s.duration>=e&&(i+=s.rate),i},0),s=0;return CSV.technology[this.coinTechnologylv].reward&&(s=parseInt(CSV.technology[this.coinTechnologylv].reward)/100),i+s},_solveSpeedUpRateByTime(t,e){return this._speedUpRates.reduce(function(i,s){return s.start<=t&&s.start+s.duration>=e&&(i+=s.rate),i},0)}},window._LocalDataDefault={};