window.Utils={POST:function(e,t,n){var o=new XMLHttpRequest;o.onloadend=function(){200==o.status?n(null,o.responseText):n(!0)},o.open("POST",e,!0),o.setRequestHeader("Content-Type","application/json;charset=utf-8 "),o.setRequestHeader("clientVersion",Config.version),o.send(JSON.stringify(t))},loadHeadIcon:function(e,t,n){""!=t&&null!=t&&cc.loader.load({url:t,type:"png"},function(t,o){cc.isValid(e.node)&&(e.spriteFrame=new cc.SpriteFrame(o),e.node.width=n,e.node.height=n)})},loadHeadIconAndVerification:function(e,t,n,o){""!=t&&null!=t&&cc.loader.load({url:t,type:"png"},function(t,c){cc.isValid(e.node)&&o()&&(e.spriteFrame=new cc.SpriteFrame(c),e.node.width=n,e.node.height=n)})},mixObj:function(e,t){_.each(t,function(n,o){t.hasOwnProperty(o)&&"function"!=typeof n&&(e[o]=n)})},fixBg:function(e){let t=e.height,n=cc.view.getVisibleSize();n.height>t&&(e.scale=n.height/t)},formatNumber:function(e){let t=function(e){let t=e.toExponential(8).split("e"),n=parseInt(t[1])+1,o=t[0],c=o.split(".");o=c[0]+c[1];let i=Math.floor(n/3);3*i==n?i-=2:i--,i<0&&(i=0);let a=o.substr(0,n-3*i);return a=parseInt(a),{preNum:numeral(a).format("0,0"),threeZeroMu:i}}(e);if(t.threeZeroMu<5){let e=["","K","M","B","T"];return t.preNum+e[t.threeZeroMu]}{let e=t.threeZeroMu-5,n=Math.floor(e/26),o=e%26;if(n>26)return"999,999zz";{let e=String.fromCharCode(n+97)+String.fromCharCode(o+97);return t.preNum+e}}},formatNickName:function(e){return e},setCascadeColorAndOpacity:function(e,t,n){e.color=t,e.opactiy=n;for(var o=e.children,c=0;c<o.length;c++)Utils.setCascadeColorAndOpacity(o[c],t,n)},showToast:function(e){cc.sys.platform==cc.sys.WECHAT_GAME?wx.showToast({title:e,icon:"none"}):cc.sys.platform==cc.sys.BYTE_GAME?wx.showToast({title:e,icon:"none"}):cc.sys.platform==cc.sys.MEIZU_GAME&&mz.showToast({duration:0,message:e})},showDev:function(e){cc.find("Canvas/devLabel").getComponent(cc.Label).string=e},showNotEnoughCoin:function(){Utils.loadResWithCorrection("Prefab/coinLackLayer/coinLackLayer",cc.Prefab,function(e,t){if(e)cc.log(e);else{if(cc.find("Canvas/coinLackLayer"))return;cc.instantiate(t).parent=cc.find("Canvas")}})},solveMasterRewardProgress:function(e){return Math.pow((e+Config.masterFixReward)/(Config.masterMaxReward+Config.masterFixReward),.1)},parseColor:function(e){let t=e.split("-"),n=parseInt(t[0]),o=parseInt(t[1]),c=parseInt(t[2]);return cc.color(n,o,c,255)},adaptNode:function(e,t){t=t||e.height,cc.view.getVisibleSize().height<t&&(e.scale=cc.view.getVisibleSize().height/t)},solveLottery:function(){let e=[],t=0;for(let c=1;c<=6;c++){let n=parseFloat(CSV.lottery[c].probability);e.push(n),t+=n}let n=Math.random()*t,o=0;for(let c=0;c<e.length;c++)if((o+=e[c])>=n)return c;return e.length-1},unique:function(e){for(var t=[],n=0;n<e.length;n++)-1==t.indexOf(e[n])&&t.push(e[n]);return t},inAction:function(e,t,n){n.active=!0;let o=cc.scaleTo(.3,1).easing(cc.easeBackOut()),c=cc.callFunc(function(){n.active=!1},this);t.scale=.2,t.runAction(cc.sequence(o,c))},outAction:function(e,t,n){n.active=!0;let o=cc.scaleTo(.3,.1).easing(cc.easeBackIn()),c=cc.callFunc(function(){e.destroy()},this);t.runAction(cc.sequence(o,c))},aesEncrypt:function(e,t){t=t||[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16];var n=aesjs.utils.utf8.toBytes(e),o=new aesjs.ModeOfOperation.ctr(t,new aesjs.Counter(5)).encrypt(n);return aesjs.utils.hex.fromBytes(o)},aesDecrypt:function(e,t){t=t||[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16];var n=aesjs.utils.hex.toBytes(e),o=new aesjs.ModeOfOperation.ctr(t,new aesjs.Counter(5)).decrypt(n);return aesjs.utils.utf8.fromBytes(o)},setNodeJelly:function(e,t){t=t||1,e.stopActionByTag(105);let n=cc.scaleTo(.15,.9*t,1.1*t),o=cc.scaleTo(.15,1.1*t,.9*t),c=cc.scaleTo(.15,1*t),i=cc.sequence(n,o,c);e.runAction(i).setTag(105)},setNodeJellyForever:function(e,t,n,o){t=t||1,n=n||1,o=o||1,e.stopActionByTag(105);let c=(1*Math.random()+1)/n,i=.05*o,a=cc.scaleTo(c,(1-i)*t,(1+i)*t),s=cc.scaleTo(c,(1+i)*t,(1-i)*t),r=cc.sequence(a,s),l=cc.repeatForever(r);e.runAction(l).setTag(105)},stopNodeJellyForever:function(e,t){t=t||1,e.stopActionByTag(105),e.scale=t},setNodeJellyForeverForPlunder:function(e,t){let n=[e,t],o=1*Math.random()+1;for(let c=0;c<n.length;c++){let e=n[c],t=cc.scaleTo(o,.75,1.25),i=cc.scaleTo(o,1.25,.75),a=cc.sequence(t,i),s=cc.repeatForever(a);e.runAction(s).setTag(105)}},clearData:function(){LocalData.clear(),cc.director.loadScene("LoginScene")},convertToWXStyle:function(e,t,n,o){const{screenWidth:c,screenHeight:i}=wx.getSystemInfoSync();let a=cc.view.getVisibleSize().height/i,s=n/a,r=o/a,l={left:e/a-s/2,top:i-t/a-r/2,width:s,height:r};return cc.log("convertToWXStyle scaleValue",a,l),l},sendWhoInvite:function(e,t){if(null==e||""==e)return;let n={id:e.toString(),openid:LocalData.wxUserInfo.openid,nickname:LocalData.wxUserInfo.nickname,avatar:LocalData.wxUserInfo.avatar,isFirst:t,gameName:"merge_monster"};cc.log(n),Utils.POST(Config.service.invitedAdd,n,function(e){e?cc.log("\u8c01\u9080\u8bf7\u4e86\u6211\u4e0a\u4f20\u5931\u8d25\u4e86"):cc.log("\u8c01\u9080\u8bf7\u4e86\u6211\u4e0a\u4f20\u6210\u529f\u4e86")})},getMeInvitedWho:function(e){if(""==LocalData.wxUserInfo.id||null==LocalData.wxUserInfo.id)return void e("\u6ca1\u6709Id");let t={id:LocalData.wxUserInfo.id.toString(),gameName:"merge_monster"};Utils.POST(Config.service.invetedGet,t,function(t,n){if(t)e(t);else{let t=JSON.parse(n);cc.log(t),e(null,t.friends)}})},offsetDay:function(e,t){let n=moment(1e3*e).dayOfYear();return moment(1e3*t).dayOfYear()-n},_timeOffset:0,setTimestamp:function(e){let t=moment().unix();this._timeOffset=e-t},getCurTime:function(){return moment().unix()+this._timeOffset},convertQueryToObject:function(e){let t=e.split("&"),n={};for(let o=0;o<t.length;o++){let e=t[o].split("=");n[e[0]]=e[1]}return n},converObjectToQuery:function(e){let t=[];for(let n in e)e.hasOwnProperty(n)&&t.push(n+"="+e[n]);return t.join("&")},isIPhoneX:function(e){return-1!=e.indexOf("iPhone X")},putEgg:function(e){cc.find("Canvas/CheckBoard").getComponent("CheckBoardCtrl").putEgg(e,1,3)},path2repeatTime:{},loadResWithCorrection(e,t,n){this.path2repeatTime[e]=3,this._loadResWithCorrection(e,t,n)},_loadResWithCorrection(e,t,n){cc.loader.loadRes(e,t,function(o,c){if(o)return this.path2repeatTime[e]--,0==this.path2repeatTime[e]?cc.sys.platform==cc.sys.WECHAT_GAME||cc.sys.platform==cc.sys.QQ_PLAY?window.wx.showModal({title:"\u9519\u8bef",content:"\u52a0\u8f7d\u8d44\u6e90\u5931\u8d25\uff0c\u8bf7\u68c0\u67e5\u7f51\u7edc\u540e\u70b9\u51fb\u786e\u5b9a\u6309\u94ae\u91cd\u8bd5",success:function(){this.path2repeatTime[e]=3,this._loadResWithCorrection(e,t,n)}.bind(this)}):cc.sys.platform==cc.sys.OPPO_GAME?qg.showModal({title:"\u9519\u8bef",content:"\u52a0\u8f7d\u8d44\u6e90\u5931\u8d25\uff0c\u8bf7\u68c0\u67e5\u7f51\u7edc\u540e\u70b9\u51fb\u786e\u5b9a\u6309\u94ae\u91cd\u8bd5",showCancel:!1,success:function(){this.path2repeatTime[e]=3,this._loadResWithCorrection(e,t,n)}.bind(this)}):cc.sys.platform==cc.sys.VIVO_GAME?qg.showDialog({title:"\u9519\u8bef",message:"\u52a0\u8f7d\u8d44\u6e90\u5931\u8d25\uff0c\u8bf7\u68c0\u67e5\u7f51\u7edc\u540e\u70b9\u51fb\u786e\u5b9a\u6309\u94ae\u91cd\u8bd5",buttons:[{text:"\u786e\u5b9a"}],complete:function(){this.path2repeatTime[e]=3,this._loadResWithCorrection(e,t,n)}.bind(this)}):cc.sys.platform==cc.sys.BYTE_GAME?tt.showModal({title:"\u9519\u8bef",content:"\u4e0b\u8f7d\u8d44\u6e90\u5931\u8d25\uff0c\u8bf7\u68c0\u67e5\u7f51\u7edc\uff0c\u5e76\u4e14\u91cd\u542f\u6e38\u620f",showCancel:!1,success:function(){this.path2repeatTime[e]=3,this._loadResWithCorrection(e,t,n)}.bind(this)}):(cc.log("\u73a9\u547d\u7684\u52a0\u8f7d\u4e5f\u5931\u8d25\u4e86"),n(o,c)):(cc.log("\u91cd\u8bd5:"+e+" \u8fd8\u5269"+this.path2repeatTime[e]),this._loadResWithCorrection(e,t,n)),cc.log(o);n(o,c)}.bind(this))}},window.Utils.Params={_param:{},put:function(e,t){cc.assert(null==this._param[e],"key  already exists, you will recove it"),this._param[e]=t},get:function(e){let t=this._param[e];return delete this._param[e],t},clear:function(){this._param={}}},window.Utils.Dialog={show:function(e,t){cc.find("Canvas/dialog").getComponent("dialogCtrl").show(e,t)},hide:function(e){e=e||1,cc.find("Canvas/dialog").getComponent("dialogCtrl").hide(e)},hideImmediately:function(){cc.find("Canvas/dialog").getComponent("dialogCtrl").hideImmediately()}};