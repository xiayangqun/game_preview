System.register("chunks:///_virtual/ColourSpriteCtrl.ts",["./rollupPluginModLoBabelHelpers.js","cc","./DrawSpriteCtrl.ts","./PaletterCtrl.ts"],(function(t){var e,r,i,n,a,o,h,s,l,u,p,c,x,f,_,d,g;return{setters:[function(t){e=t.applyDecoratedDescriptor,r=t.inheritsLoose,i=t.initializerDefineProperty,n=t.assertThisInitialized,a=t.createForOfIteratorHelperLoose},function(t){o=t.cclegacy,h=t._decorator,s=t.gfx,l=t.director,u=t.Sprite,p=t.UITransform,c=t.Node,x=t.Vec3,f=t.Vec2,_=t.Component},function(t){d=t.SparseMarker},function(t){g=t.PaletterCtrl}],execute:function(){var w,v,y,D,C,P,S;t("readSpriteFramePixels",T),o._RF.push({},"791a6FQmfhLkpdSePoIR/9x","ColourSpriteCtrl",void 0);var M=h.ccclass,m=h.property;function T(t,e){var r=t.texture;if(!r)return console.error("SpriteFrame 没有关联 texture"),null;var i=r.getGFXTexture();if(!i)return console.error("无法获取 GFX 纹理对象"),null;var n=t.rect,a=n.x,o=n.y,h=n.width,u=n.height,p=h*u*4;if(e){if(e.length<p)return console.error("提供的缓冲区太小"),null}else e=new Uint8Array(p);var c=new s.BufferTextureCopy;return c.texOffset.x=a,c.texOffset.y=o,c.texExtent.width=h,c.texExtent.height=u,l.root.device.copyTextureToBuffers(i,[e],[c]),e}t("colour",(w=M("colour"),v=m(u),y=m(g),w((P=e((C=function(t){function e(){for(var e,r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return e=t.call.apply(t,[this].concat(a))||this,i(e,"showSprite",P,n(e)),i(e,"paletterCtrl",S,n(e)),e._width=0,e._height=0,e._originData=null,e._pixelData=null,e._texture=null,e._isColouring=!1,e._mapedMarker=new d,e._nextMarkerPoint=[],e}r(e,t);var o=e.prototype;return o.start=function(){var t=this.showSprite.getComponent(p).contentSize;this._width=t.width,this._height=t.height,this._texture=this.showSprite.spriteFrame.texture,this._pixelData=T(this.showSprite.spriteFrame),this._originData=this._pixelData.slice(),console.log(this._pixelData.length),console.log(this._originData.length)},o.onEnable=function(){this.node.on(c.EventType.TOUCH_START,this.onTouchStart,this)},o.onDisable=function(){this.node.off(c.EventType.TOUCH_START,this.onTouchStart,this)},o.onTouchStart=function(t){var e;if(!this._isColouring){this._mapedMarker.clear(),this._nextMarkerPoint.length=0;var r=t.getUILocation(),i=null==(e=this.node.getComponent(p))?void 0:e.convertToNodeSpaceAR(new x(r.x,r.y,0));if(i){var n=Math.floor(i.x),a=-i.y;a=Math.floor(a),this._nextMarkerPoint.push(new f(n,a)),this._isColouring=!0}}},o.updatePixelData=function(t,e,r,i,n,a){if(!(t<0||t>=this._width||e<0||e>=this._height)){var o=4*(e*this._width+t),h=this._pixelData[o+0],s=this._pixelData[o+1],l=this._pixelData[o+2],u=this._pixelData[o+3]/255,p=a/255,c=p+u*(1-p),x=r*p/255+h*u/255*(1-p),f=i*p/255+s*u/255*(1-p),_=n*p/255+l*u/255*(1-p),d=Math.round(255*c),g=0===c?0:Math.round(x/c*255),w=0===c?0:Math.round(f/c*255),v=0===c?0:Math.round(_/c*255);this._pixelData[o+0]=g,this._pixelData[o+1]=w,this._pixelData[o+2]=v,this._pixelData[o+3]=d}},o.getPixelData=function(t,e,r,i){if(e<0||e>=this._width||r<0||r>=this._height)return!1;var n=4*(r*this._width+e);return i[0]=t[n+0],i[1]=t[n+1],i[2]=t[n+2],i[3]=t[n+3],!0},o.canWritePixel=function(t){return t[0]>240&&t[1]>240&&t[2]>240},o.getPixelAround=function(t,e){var r=this,i=[];return i.push(new f(t+1,e)),i.push(new f(t-1,e)),i.push(new f(t,e+1)),i.push(new f(t,e-1)),i.push(new f(t+1,e+1)),i.push(new f(t-1,e+1)),i.push(new f(t+1,e-1)),i.push(new f(t-1,e-1)),i.push(new f(t,e-2)),i.push(new f(t,e+2)),i.push(new f(t-2,e)),i.push(new f(t+2,e)),i=i.filter((function(t){return!r._mapedMarker.has(t.x,t.y)&&t.x>=0&&t.x<r._width&&t.y>=0&&t.y<r._height}))},o.update=function(t){if(this._isColouring)if(this._nextMarkerPoint.length>0){for(var e=3,r=this.paletterCtrl.r,i=this.paletterCtrl.g,n=this.paletterCtrl.b,o=this.paletterCtrl.a,h=[0,0,0,0];e>0&&this._nextMarkerPoint.length>0;){for(var s,l=[],u=a(this._nextMarkerPoint);!(s=u()).done;){var p=s.value;if(!this._mapedMarker.has(p.x,p.y)&&this.getPixelData(this._originData,p.x,p.y,h)){if(!this.canWritePixel(h))continue;this._mapedMarker.mark(p.x,p.y),this.updatePixelData(p.x,p.y,r,i,n,o);var c=this.getPixelAround(p.x,p.y);l.push.apply(l,c)}}this._nextMarkerPoint=l,e--}this._texture.uploadData(this._pixelData)}else this._isColouring=!1},e}(_)).prototype,"showSprite",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),S=e(C.prototype,"paletterCtrl",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),D=C))||D));o._RF.pop()}}}));

System.register("chunks:///_virtual/DrawSpriteCtrl.ts",["./rollupPluginModLoBabelHelpers.js","cc","./PaletterCtrl.ts"],(function(t){var e,i,r,a,h,o,n,s,l,p,u,c,_,f,d,x;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,r=t.initializerDefineProperty,a=t.assertThisInitialized},function(t){h=t.cclegacy,o=t._decorator,n=t.Sprite,s=t.Vec2,l=t.UITransform,p=t.Texture2D,u=t.ImageAsset,c=t.SpriteFrame,_=t.Node,f=t.Vec3,d=t.Component},function(t){x=t.PaletterCtrl}],execute:function(){var T,v,y,D,M,C,m;h._RF.push({},"515b0hpF91G9KIt1wu3P0UI","DrawSpriteCtrl",void 0);var w=o.ccclass,g=o.property,S=t("SparseMarker",function(){function t(){this.set=new Set}var e=t.prototype;return e.key=function(t,e){return 2654435769*t^e},e.mark=function(t,e){this.set.add(this.key(t,e))},e.has=function(t,e){return this.set.has(this.key(t,e))},e.clear=function(){this.set.clear()},t}());t("DrawSpriteCtrl",(T=w("DrawSpriteCtrl"),v=g(n),y=g(x),T((C=e((M=function(t){function e(){for(var e,i=arguments.length,h=new Array(i),o=0;o<i;o++)h[o]=arguments[o];return e=t.call.apply(t,[this].concat(h))||this,r(e,"drawSprite",C,a(e)),r(e,"paletterCtrl",m,a(e)),e._prePos=new s(0,0),e._width=0,e._height=0,e._pixelData=null,e._texture=null,e._isDirty=!1,e._marker=new S,e}i(e,t);var h=e.prototype;return h.start=function(){var t=this.drawSprite.getComponent(l).contentSize;this._width=t.width,this._height=t.height,this._pixelData=new Uint8Array(this._width*this._height*4);for(var e=0;e<this._width*this._height;e++)this._pixelData[4*e+0]=255,this._pixelData[4*e+1]=255,this._pixelData[4*e+2]=255,this._pixelData[4*e+3]=255;this._texture=new p;var i=new u({_data:this._pixelData,_compressed:!1,width:this._width,height:this._height,format:p.PixelFormat.RGBA8888});this._texture.image=i,this._texture.uploadData(this._pixelData);var r=new c;r.packable=!1,r.texture=this._texture,this.drawSprite.spriteFrame=r},h.onEnable=function(){this.node.on(_.EventType.TOUCH_START,this.onTouchStart,this),this.node.on(_.EventType.TOUCH_MOVE,this.onTouchMove,this),this.node.on(_.EventType.TOUCH_END,this.onTouchEnd,this),this.node.on(_.EventType.TOUCH_CANCEL,this.onTouchCancel,this)},h.onDisable=function(){this.node.off(_.EventType.TOUCH_START,this.onTouchStart,this),this.node.off(_.EventType.TOUCH_MOVE,this.onTouchMove,this),this.node.off(_.EventType.TOUCH_END,this.onTouchEnd,this),this.node.off(_.EventType.TOUCH_CANCEL,this.onTouchCancel,this)},h.onTouchStart=function(t){this._marker.clear(),this._prePos.set(0,0),this.onTouchMove(t)},h.onTouchMove=function(t){var e,i=t.getUILocation(),r=null==(e=this.node.getComponent(l))?void 0:e.convertToNodeSpaceAR(new f(i.x,i.y,0));if(r){for(var a=this.paletterCtrl.r,h=this.paletterCtrl.g,o=this.paletterCtrl.b,n=this.paletterCtrl.a,s=this.paletterCtrl.size,p=Math.floor(r.x),u=Math.floor(r.y),c=s/2,_=[],d=Math.floor(u-c);d<=Math.ceil(u+c);d++)for(var x=Math.floor(p-c);x<=Math.ceil(p+c);x++){var T=x-p,v=d-u;T*T+v*v<=c*c&&_.push({x:x,y:d})}for(var y=0,D=_;y<D.length;y++){var M=D[y];this._marker.has(M.x,M.y)||(this._marker.mark(M.x,M.y),this.updatePixelData(M.x,M.y,a,h,o,n))}if(0!==this._prePos.x||0!==this._prePos.y)for(var C=Math.floor(this._prePos.x),m=Math.floor(this._prePos.y),w=Math.floor(r.x),g=Math.floor(r.y),S=s/2,E=Math.floor(Math.min(C,w)-S),P=Math.ceil(Math.max(C,w)+S),k=Math.floor(Math.min(m,g)-S),b=Math.ceil(Math.max(m,g)+S),U=w-C,O=g-m,A=U*U+O*O,H=k;H<=b;H++)for(var z=E;z<=P;z++){var F=0;0!==A&&(F=((z-C)*U+(H-m)*O)/A,F=Math.max(0,Math.min(1,F)));var I=C+F*U,N=m+F*O;(z-I)*(z-I)+(H-N)*(H-N)<=S*S&&(this._marker.has(z,H)||(this._marker.mark(z,H),this.updatePixelData(z,H,a,h,o,n)))}this._prePos.set(r.x,r.y)}},h.updatePixelData=function(t,e,i,r,a,h){if(t=Math.floor(t),e=-e,e=Math.floor(e),!(t<0||t>=this._width||e<0||e>=this._height)){var o=4*(e*this._width+t),n=this._pixelData[o+0],s=this._pixelData[o+1],l=this._pixelData[o+2],p=this._pixelData[o+3]/255,u=h/255,c=u+p*(1-u),_=i*u/255+n*p/255*(1-u),f=r*u/255+s*p/255*(1-u),d=a*u/255+l*p/255*(1-u),x=Math.round(255*c),T=0===c?0:Math.round(_/c*255),v=0===c?0:Math.round(f/c*255),y=0===c?0:Math.round(d/c*255);this._pixelData[o+0]=T,this._pixelData[o+1]=v,this._pixelData[o+2]=y,this._pixelData[o+3]=x,this._isDirty=!0}},h.update=function(t){this._isDirty&&(this._texture.uploadData(this._pixelData),this._isDirty=!1)},h.onTouchEnd=function(t){this.onTouchCancel(t)},h.onTouchCancel=function(t){console.log("onTouchCancel")},e}(d)).prototype,"drawSprite",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),m=e(M.prototype,"paletterCtrl",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),D=M))||D));h._RF.pop()}}}));

System.register("chunks:///_virtual/main",["./ColourSpriteCtrl.ts","./DrawSpriteCtrl.ts","./PaletterCtrl.ts","./PaletterSliderCtrl.ts","./StartSceneCtrl.ts"],(function(){return{setters:[null,null,null,null,null],execute:function(){}}}));

System.register("chunks:///_virtual/PaletterCtrl.ts",["./rollupPluginModLoBabelHelpers.js","cc","./PaletterSliderCtrl.ts"],(function(e){var t,r,i,s,a,n,l,o,u,h,c,p,d,f,v;return{setters:[function(e){t=e.applyDecoratedDescriptor,r=e.inheritsLoose,i=e.initializerDefineProperty,s=e.assertThisInitialized,a=e.createClass},function(e){n=e.cclegacy,l=e._decorator,o=e.Sprite,u=e.Texture2D,h=e.ImageAsset,c=e.SpriteFrame,p=e.UITransform,d=e.Size,f=e.Component},function(e){v=e.PaletterSliderCtrl}],execute:function(){var g,w,S,m,b,y,C;n._RF.push({},"19b6cYeCCNKcK/AeEJJBasN","PaletterCtrl",void 0);var _=l.ccclass,x=l.property;e("PaletterCtrl",(g=_("PaletterCtrl"),w=x([v]),S=x(o),g((y=t((b=function(e){function t(){for(var t,r=arguments.length,a=new Array(r),n=0;n<r;n++)a[n]=arguments[n];return t=e.call.apply(e,[this].concat(a))||this,i(t,"sliders",y,s(t)),t._texture=null,i(t,"showSprite",C,s(t)),t.r=0,t.g=0,t.b=0,t.a=0,t}r(t,e);var n=t.prototype;return n.start=function(){this.r=this.sliders[0].value,this.g=this.sliders[1].value,this.b=this.sliders[2].value,this.a=this.sliders[3].value;for(var e=new Uint8Array(4e4),t=0;t<1e4;t++)e[4*t+0]=0,e[4*t+1]=0,e[4*t+2]=0,e[4*t+3]=255;this._texture=new u;var r=new h({_data:e,_compressed:!1,width:100,height:100,format:u.PixelFormat.RGBA8888});this._texture.image=r,this._texture.uploadData(e);var i=new c;i.packable=!1,i.texture=this._texture,this.showSprite.spriteFrame=i},n.onSliderEvent=function(){this.r=this.sliders[0].value,this.g=this.sliders[1].value,this.b=this.sliders[2].value,this.a=this.sliders[3].value;for(var e=new Uint8Array(4e4),t=0;t<1e4;t++)e[4*t+0]=this.r,e[4*t+1]=this.g,e[4*t+2]=this.b,e[4*t+3]=this.a;this._texture.uploadData(e)},n.onSizeSliderEvent=function(e){var t=Math.floor(100*e.progress);this.showSprite.getComponent(p).contentSize=new d(t,t)},a(t,[{key:"size",get:function(){return this.showSprite.getComponent(p).width}}]),t}(f)).prototype,"sliders",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),C=t(b.prototype,"showSprite",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),m=b))||m));n._RF.pop()}}}));

System.register("chunks:///_virtual/PaletterSliderCtrl.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var t,r,i,l,n,a,o,s,u,c;return{setters:[function(e){t=e.applyDecoratedDescriptor,r=e.inheritsLoose,i=e.initializerDefineProperty,l=e.assertThisInitialized},function(e){n=e.cclegacy,a=e._decorator,o=e.Slider,s=e.Label,u=e.EventHandler,c=e.Component}],execute:function(){var p,d,v,f,h,b,g,y,E;n._RF.push({},"d3726xExTdC0bgQaEipWjeQ","PaletterSliderCtrl",void 0);var S=a.ccclass,L=a.property;e("PaletterSliderCtrl",(p=S("PaletterSliderCtrl"),d=L(o),v=L(s),f=L([u]),p((g=t((b=function(e){function t(){for(var t,r=arguments.length,n=new Array(r),a=0;a<r;a++)n[a]=arguments[a];return(t=e.call.apply(e,[this].concat(n))||this).value=0,i(t,"slider",g,l(t)),i(t,"valueLabel",y,l(t)),i(t,"slideEvents",E,l(t)),t}r(t,e);var n=t.prototype;return n.onLoad=function(){this.value=Math.floor(255*this.slider.progress)},n.update=function(e){},n.onSliderEvent=function(e){this.value=Math.floor(255*e.progress),this.valueLabel.string=this.value.toString(),u.emitEvents(this.slideEvents,this)},t}(c)).prototype,"slider",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),y=t(b.prototype,"valueLabel",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),E=t(b.prototype,"slideEvents",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),h=b))||h));n._RF.pop()}}}));

System.register("chunks:///_virtual/StartSceneCtrl.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var r,n,e,o,c;return{setters:[function(t){r=t.inheritsLoose},function(t){n=t.cclegacy,e=t._decorator,o=t.director,c=t.Component}],execute:function(){var u;n._RF.push({},"6c8c0cu/+9IjrQftnHtXbbv","StartSceneCtrl",void 0);var i=e.ccclass;e.property,t("StartSceneCtrl",i("StartSceneCtrl")(u=function(t){function n(){return t.apply(this,arguments)||this}r(n,t);var e=n.prototype;return e.onDrawButtonClick=function(){o.loadScene("draw")},e.onColourButtonClick=function(){o.loadScene("colour")},n}(c))||u);n._RF.pop()}}}));

(function(r) {
  r('virtual:///prerequisite-imports/main', 'chunks:///_virtual/main'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});